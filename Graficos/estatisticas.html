<!doctype html>

<html>
	<head>
	  <meta charset="utf-8">

	  <title>Estatísticas de Escalonamento</title>

	  <link rel="stylesheet" href="bootstrap.css">
	  <link rel="stylesheet" href="style.css">
	  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">	
	  <script src="Chart.min.js"></script>

	</head>

	<body>
		<div id="divSelecionadorDeArquivo" class="text-center">
			<h2>Selecione o arquivo "estatisticas.txt"</h2>
			<br>
			<input id="selecionadorDeArquivo" onchange="selecionouArquivo()" type="file"></input>
		</div>
		<div id="all" class="container-fluid">
			<div class="row" id="tituloPagina">
				<div class="col-sm-12">
					<h3>Estatísticas para os Escalonadores:</h3>
				</div>
			</div>
			<div class="row">
				<div class="col-sm-4">
					<div id="divGraficoTempoTotal" onmouseover="destacarDivGrafico(this.id)" onmouseout="removerDestaqueDivGrafico(this.id)" class="grafico panel panel-info">
						<div class="panel-heading"><div class="tituloGrafico">Tempo Total</div><div class="text-right"><a href="#" id="tooltipBotaoAlternarTipoGraficoTempoTotal" data-toggle="tooltip" title="Alternar para Gráfico de Linha"><button id="botaoAlternarTipoGraficoTempoTotal" onclick="alternarTipoGrafico(this.id)" class="botaoMudarTipoGrafico"> <i class="fa fa-line-chart"></i></button></a></div></div>
						<div id="containerGraficoTempoTotal" class="panel-body">
							<canvas id="graficoTempoTotal"></canvas>
						</div>
					</div>
				</div>

				<div class="col-sm-4">
					<div id="divGraficoMediaThroughput" onmouseover="destacarDivGrafico(this.id)" onmouseout="removerDestaqueDivGrafico(this.id)" class="grafico panel panel-info">
						<div class="panel-heading"><div class="tituloGrafico">Média de Throughput</div><div class="text-right"><a href="#" id="tooltipBotaoAlternarTipoGraficoMediaThroughput" data-toggle="tooltip" title="Alternar para Gráfico de Linha"><button id="botaoAlternarTipoGraficoMediaThroughput" onclick="alternarTipoGrafico(this.id)" class="botaoMudarTipoGrafico"> <i class="fa fa-line-chart"></i></button></a></div></div>
						<div id="containerGraficoMediaThroughput" class="panel-body">
							<canvas id="graficoMediaThroughput"></canvas>
						</div>
					</div>
				</div>

				<div class="col-sm-4">
					<div id="divGraficoMediaTurnaround" onmouseover="destacarDivGrafico(this.id)" onmouseout="removerDestaqueDivGrafico(this.id)" class="grafico panel panel-info">
						<div class="panel-heading"><div class="tituloGrafico">Média de Turnaround</div><div class="text-right"><a href="#" id="tooltipBotaoAlternarTipoGraficoMediaTurnaround" data-toggle="tooltip" title="Alternar para Gráfico de Linha"><button id="botaoAlternarTipoGraficoMediaTurnaround" onclick="alternarTipoGrafico(this.id)" class="botaoMudarTipoGrafico"> <i class="fa fa-line-chart"></i></button></a></div></div>
						<div  id="containerGraficoMediaTurnaround" class="panel-body">
							<canvas id="graficoMediaTurnaround"></canvas>
						</div>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-sm-4">
					<div id="divGraficoMediaTempoEspera" onmouseover="destacarDivGrafico(this.id)" onmouseout="removerDestaqueDivGrafico(this.id)" class="grafico panel panel-info">
						<div class="panel-heading"><div class="tituloGrafico">Média do Tempo de Espera</div><div class="text-right"><a href="#" id="tooltipBotaoAlternarTipoGraficoMediaTempoEspera" data-toggle="tooltip" title="Alternar para Gráfico de Linha"><button id="botaoAlternarTipoGraficoMediaTempoEspera" onclick="alternarTipoGrafico(this.id)" class="botaoMudarTipoGrafico"> <i class="fa fa-line-chart"></i></button></a></div></div>
						<div id="containerGraficoMediaTempoEspera" class="panel-body">
							<canvas id="graficoMediaTempoEspera"></canvas>
						</div>
					</div>
				</div>
				<div class="col-sm-4">
					<div id="divGraficoMediaTempoResposta" onmouseover="destacarDivGrafico(this.id)" onmouseout="removerDestaqueDivGrafico(this.id)" class="grafico panel panel-info">
						<div class="panel-heading"><div class="tituloGrafico">Média do Tempo de Resposta</div><div class="text-right"><a href="#" id="tooltipBotaoAlternarTipoGraficoMediaTempoResposta" data-toggle="tooltip" title="Alternar para Gráfico de Linha"><button id="botaoAlternarTipoGraficoMediaTempoResposta" onclick="alternarTipoGrafico(this.id)" class="botaoMudarTipoGrafico"> <i class="fa fa-line-chart"></i></button></a></div></div>
						<div  id="containerGraficoMediaTempoResposta" class="panel-body">
							<canvas id="graficoMediaTempoResposta"></canvas>
						</div>
					</div>
				</div>
				<div class="col-sm-4">
					<div id="divGraficoMediaTrocaContexto" onmouseover="destacarDivGrafico(this.id)" onmouseout="removerDestaqueDivGrafico(this.id)" class="grafico panel panel-info">
						<div class="panel-heading"><div class="tituloGrafico">Média da Troca de Contexto dos Processos</div><div class="text-right"><a href="#" id="tooltipBotaoAlternarTipoGraficoMediaTrocaContexto" data-toggle="tooltip" title="Alternar para Gráfico de Linha"><button id="botaoAlternarTipoGraficoMediaTrocaContexto" onclick="alternarTipoGrafico(this.id)" class="botaoMudarTipoGrafico"> <i class="fa fa-line-chart"></i></button></a></div></div>
						<div id="containerGraficoMediaTrocaContexto" class="panel-body">
							<canvas id="graficoMediaTrocaContexto"></canvas>
						</div>
					</div>
				</div>				
			</div>

			<div class="row">
				<div class="col-sm-4">
					<div id="divGraficoNumeroProcessos" onmouseover="destacarDivGrafico(this.id)" onmouseout="removerDestaqueDivGrafico(this.id)" class="grafico panel panel-info">
						<div class="panel-heading"><div class="tituloGrafico">Número de Processos</div><div class="text-right"><a href="#" id="tooltipBotaoAlternarTipoGraficoNumeroProcessos" data-toggle="tooltip" title="Alternar para Gráfico de Linha"><button id="botaoAlternarTipoGraficoNumeroProcessos" onclick="alternarTipoGrafico(this.id)" class="botaoMudarTipoGrafico"> <i class="fa fa-line-chart"></i></button></a></div></div>
						<div  id="containerGraficoNumeroProcessos" class="panel-body">
							<canvas id="graficoNumeroProcessos"></canvas>
						</div>
					</div>
				</div>
			</div>

		</div>
	</body>



	<script>
		var arquivo;
		var leitor = new FileReader();
		var conteudo;		
		var listaEstatisticas = [];
		var labelsEscalonadores = [];
		var ctx = {};
		ctx['tempototal'] = document.getElementById("graficoTempoTotal").getContext("2d");
		ctx['mediathroughput'] = document.getElementById("graficoMediaThroughput").getContext("2d");
		ctx['mediaturnaround'] = document.getElementById("graficoMediaTurnaround").getContext("2d");
		ctx['mediatempoespera'] = document.getElementById("graficoMediaTempoEspera").getContext("2d");
		ctx['mediatemporesposta'] = document.getElementById("graficoMediaTempoResposta").getContext("2d");
		ctx['mediatrocacontexto'] = document.getElementById("graficoMediaTrocaContexto").getContext("2d");
		ctx['numeroprocessos'] = document.getElementById("graficoNumeroProcessos").getContext("2d");		

		var dados = {};
		dados['tempototal'] = [];
		dados['mediathroughput'] = [];
		dados['mediaturnaround'] = [];
		dados['mediatempoespera'] = [];
		dados['mediatemporesposta'] = [];
		dados['mediatrocacontexto'] = [];
		dados['numeroprocessos'] = [];

		var tipoGrafico = {};
		tipoGrafico['tempototal'] = "barra";
		tipoGrafico['mediathroughput'] = "barra";
		tipoGrafico['mediaturnaround'] = "barra";
		tipoGrafico['mediatempoespera'] = "barra";
		tipoGrafico['mediatemporesposta'] = "barra";
		tipoGrafico['mediatrocacontexto'] = "barra";
		tipoGrafico['numeroprocessos'] = "barra";
		

		Chart.defaults.global.responsive = true;

		function selecionouArquivo(){		
			arquivo = document.getElementById("selecionadorDeArquivo").files[0];
			document.getElementById("divSelecionadorDeArquivo").style.display = 'none';
			leitor.readAsText(arquivo);
		}

		leitor.onload = function(){
			conteudo = leitor.result;
			lerArquivo();	
		}

		function lerArquivo(){
			if(navigator.userAgent.indexOf("Windows")!=-1){//se for Windows
				conteudo = conteudo.split(/[\r\n]+/g);				
				var i = 0;
				while(i < conteudo.length-1){
					listaEstatisticas.push(new Estatistica(conteudo[i], conteudo[i+1].split(":")[1], conteudo[i+3].split(":")[1],conteudo[i+4].split(":")[1],conteudo[i+5].split(":")[1],conteudo[i+6].split(":")[1],conteudo[i+7].split(":")[1],conteudo[i+8].split(":")[1]));
					i=i+9;
				}
			}else{ //se for Linux ou outro
				conteudo = conteudo.split("\n\n");
				for(var i=0; i<conteudo.length;i++){
					var linhas = conteudo[i].split('\n');
					listaEstatisticas.push(new Estatistica(linhas[0],linhas[1].split(":")[1],linhas[3].split(":")[1],linhas[4].split(":")[1],linhas[5].split(":")[1],linhas[6].split(":")[1],linhas[7].split(":")[1],linhas[8].split(":")[1]));
						alert("passou aqui");
				}
			}

			for(var k=0;k<listaEstatisticas.length;k++){
				listaEstatisticas[k].print();
			}
			desenharGraficos();
		}

		//Definicao da classe Estatistica
		function Estatistica(nomeEscalonador, tempoTotal, mediaThroughput, mediaTurnaround, mediaTempoEspera, mediaTempoResposta, mediaTrocaContexto, numeroProcessos){
			
			this.nomeEscalonador = nomeEscalonador;
			this.tempoTotal = tempoTotal;
			this.mediaThroughput = mediaThroughput;
			this.mediaTurnaround = mediaTurnaround;
			this.mediaTempoEspera = mediaTempoEspera;
			this.mediaTempoResposta = mediaTempoResposta;
			this.mediaTrocaContexto = mediaTrocaContexto;
			this.numeroProcessos = numeroProcessos;

			this.print = function(){
				console.log("Escalonador: "+this.nomeEscalonador+
							"\n    tempo total: "+ this.tempoTotal +
							"\n    media throughput: "+ this.mediaThroughput +
							"\n    media turnaround: "+ this.mediaTurnaround +
							"\n    media tempo espera: "+ this.mediaTempoEspera +
							"\n    media tempo resposta: "+ this.mediaTempoResposta +
							"\n    media troca contexto: "+ this.mediaTrocaContexto +
							"\n    numero de processos: "+ this.numeroProcessos 
							);
				return this;
			}
			return this;
		}

		function desenharGraficos(){
			document.getElementById("all").style.display = "block";

			for(var i=0; i<listaEstatisticas.length; i++){

				labelsEscalonadores.push(listaEstatisticas[i].nomeEscalonador);
				dados['tempototal'].push(listaEstatisticas[i].tempoTotal);
				dados['mediathroughput'].push(listaEstatisticas[i].mediaThroughput);
				dados['mediaturnaround'].push(listaEstatisticas[i].mediaTurnaround);
				dados['mediatempoespera'].push(listaEstatisticas[i].mediaTempoEspera);
				dados['mediatemporesposta'].push(listaEstatisticas[i].mediaTempoResposta);
				dados['mediatrocacontexto'].push(listaEstatisticas[i].mediaTrocaContexto);
				dados['numeroprocessos'].push(listaEstatisticas[i].numeroProcessos);
			};

			atualizarGrafico(ctx['tempototal'],dados['tempototal'],tipoGrafico['tempototal']);
			atualizarGrafico(ctx['mediathroughput'],dados['mediathroughput'],tipoGrafico['mediathroughput']);
			atualizarGrafico(ctx['mediaturnaround'],dados['mediaturnaround'],tipoGrafico['mediaturnaround']);
			atualizarGrafico(ctx['mediatempoespera'],dados['mediatempoespera'],tipoGrafico['mediatempoespera']);
			atualizarGrafico(ctx['mediatemporesposta'],dados['mediatemporesposta'],tipoGrafico['mediatemporesposta']);
			atualizarGrafico(ctx['mediatrocacontexto'],dados['mediatrocacontexto'],tipoGrafico['mediatrocacontexto']);
			atualizarGrafico(ctx['numeroprocessos'],dados['numeroprocessos'],tipoGrafico['numeroprocessos']);
		}

		function destacarDivGrafico(id){
			document.getElementById(id).className = document.getElementById(id).className.replace(" panel-info"," panel-primary");
		}
		function removerDestaqueDivGrafico(id){
			document.getElementById(id).className = document.getElementById(id).className.replace(" panel-primary"," panel-info");
		}

		function atualizarGrafico(ctx,dados,tipoGrafico){
			if(tipoGrafico=="barra"){
				var propriedadesGrafico = {
					labels:labelsEscalonadores,
					datasets:[
					    {
					        fillColor: "rgba(151,187,205,0.5)",
					        strokeColor: "rgba(151,187,205,0.8)",
					        highlightFill: "rgba(151,187,205,0.75)",
					        highlightStroke: "rgba(151,187,205,1)",
					        data:dados
					    }
					]
				};
				var grafico = new Chart(ctx).Bar(propriedadesGrafico);
			}else{
				var propriedadesGrafico = {
					labels:labelsEscalonadores,
					datasets:[
						{
							fillColor: "rgba(151,187,205,0.2)",
							strokeColor: "rgba(151,187,205,1)",
							pointColor: "rgba(151,187,205,1)",
							pointStrokeColor: "#fff",
							pointHighlightFill: "#fff",
							pointHighlightStroke: "rgba(151,187,205,1)",
							data:dados
				        }					
					]
				};
				var grafico = new Chart(ctx).Line(propriedadesGrafico);
			}
		}
		function alternarTipoGrafico(id){
			
			var nomeGraficoUpper = id.split("botaoAlternarTipoGrafico")[1];
			var nomeGrafico = nomeGraficoUpper.toLowerCase();

			var stringIdContainerGrafico = "containerGrafico"+nomeGraficoUpper;
			var stringNovoConteudo = "<canvas id=grafico"+nomeGraficoUpper+"></canvas>";
			document.getElementById(stringIdContainerGrafico).innerHTML = "&nbsp;";
			document.getElementById(stringIdContainerGrafico).innerHTML = stringNovoConteudo;
			ctx[nomeGrafico] = document.getElementById("grafico"+nomeGraficoUpper).getContext("2d");

			var stringIdTooltip = "tooltipBotaoAlternarTipoGrafico"+nomeGraficoUpper;

			if(tipoGrafico[nomeGrafico] == 'barra'){
				tipoGrafico[nomeGrafico] = 'linha';
				atualizarGrafico(ctx[nomeGrafico],dados[nomeGrafico],tipoGrafico[nomeGrafico]);

				document.getElementById(stringIdTooltip).title = "Alternar para Gráfico de Barras";
				document.getElementById(id).innerHTML = "<i class='fa fa-bar-chart'></i>"
				
			}else{
				tipoGrafico[nomeGrafico] = 'barra';
				atualizarGrafico(ctx[nomeGrafico],dados[nomeGrafico],tipoGrafico[nomeGrafico]);

				document.getElementById(stringIdTooltip).title = "Alternar para Gráfico de Linha";
				document.getElementById(id).innerHTML = "<i class='fa fa-line-chart'></i>"
			}			
		}

	</script>
</html>
